# HW07 – Report

> Файл: `homeworks/HW07/report.md`  
> Важно: не меняйте названия разделов (заголовков). Заполняйте текстом и/или вставляйте результаты.

## 1. Datasets

Вы выбрали 3 датасета из 4 (перечислите):

### 1.1 Dataset A (S07-hw-dataset-01.csv)

- **Файл**: `S07-hw-dataset-01.csv`
- **Размер**: (12000 строк, 9 столбцов)
- **Признаки**: Все числовые (8 числовых признаков + sample_id)
- **Пропуски**: Нет пропусков
- **"Подлости" датасета**:
  - Высокая размерность (8 признаков)
  - Разные масштабы признаков
  - Сферическая структура данных
  - Равномерная плотность кластеров

### 1.2 Dataset B (S07-hw-dataset-02.csv)

- **Файл**: `S07-hw-dataset-02.csv`
- **Размер**: (8000 строк, 4 столбца)
- **Признаки**: Все числовые (3 признака: x1, x2, z_noise + sample_id)
- **Пропуски**: Нет пропусков
- **"Подлости" датасета**:
  - Явный шумовой признак `z_noise`
  - Нелинейная структура данных
  - Разная плотность кластеров
  - Наличие выбросов

### 1.3 Dataset C (S07-hw-dataset-03.csv)

- **Файл**: `S07-hw-dataset-03.csv`
- **Размер**: (10000 строк, 7 столбцов)
- **Признаки**: Все числовые (6 числовых признаков + sample_id)
- **Пропуски**: Нет пропусков
- **"Подлости" датасета**:
  - Комбинация различных форм кластеров
  - Некоторые кластеры близко расположены
  - Смесь плотностей
  - Умеренная размерность

## 2. Protocol

### Препроцессинг:
1. **Масштабирование**: Для всех методов использовано стандартное масштабирование (StandardScaler)
2. **Отделение идентификаторов**: Столбец `sample_id` удалён из признаков
3. **Обработка пропусков**: Не требовалось (данные полные)

### Поиск гиперпараметров:
- **KMeans**:
  - Диапазон k: от 2 до 11 (включительно)
  - Критерий выбора: максимизация silhouette score при k > 1
  - Дополнительная проверка через "метод локтя" на графике inertia
  
- **DBSCAN**:
  - eps: диапазон 0.10-0.90 с шагом 0.01 (для dataset2: 0.10-0.90, для dataset1: 0.30-0.90)
  - min_samples: диапазон 8-40 с шагом 1 (для dataset2) и 20-50 с шагом 2 (для dataset1)
  - Критерий выбора: максимизация silhouette score при наличии ≥2 кластеров
  - Учёт шума: метрики считались только для точек, не помеченных как шум (-1)

### Метрики:
1. **Silhouette Score**: Основная метрика для выбора оптимального k
2. **Davies-Bouldin Index**: Вторичная метрика (меньше = лучше)
3. **Calinski-Harabasz Score**: Третичная метрика (выше = лучше)
4. **Для DBSCAN**: Дополнительно учитывалась доля шума (noise_ratio)

### Визуализация:
1. **PCA 2D**: Обязательная визуализация для всех датасетов
2. **Параметры PCA**: n_components=2, random_state=42
3. **Дополнительно**: Графики метрик vs k для KMeans и тепловые карты для DBSCAN
4. **t-SNE**: Не использовался в основном анализе для сохранения воспроизводимости

## 3. Models

Для каждого датасета сравнивались:

### Dataset 1:
- **KMeans**: 
  - Диапазон k: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
  - random_state=42, n_init=10
- **DBSCAN**:
  - eps: [0.30, 0.31, ..., 0.89]
  - min_samples: [20, 22, ..., 48]

### Dataset 2:
- **KMeans**: 
  - Диапазон k: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
  - random_state=42, n_init=10
- **DBSCAN**:
  - eps: [0.10, 0.11, ..., 0.89]
  - min_samples: [8, 9, ..., 39]

### Dataset 3:
- **KMeans**: 
  - Диапазон k: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
  - random_state=42, n_init=10
- **DBSCAN**:
  - eps: [0.10, 0.11, ..., 0.89]
  - min_samples: [8, 9, ..., 39]

## 4. Results

### 4.1 Dataset A (S07-hw-dataset-01.csv)

- **Лучший метод**: KMeans
- **Параметры**: k=2
- **Метрики**:
  - Silhouette: 0.522
  - Davies-Bouldin: 0.685
  - Calinski-Harabasz: 11786.95
- **DBSCAN лучший**: eps=0.60, min_samples=38
  - Silhouette: 0.401
  - Davies-Bouldin: 1.172
  - Доля шума: 0.0%
- **Обоснование**: KMeans показывает значительно лучшие метрики (silhouette на 30% выше). Данные имеют сферическую структуру с равномерной плотностью, что соответствует предположениям KMeans.

### 4.2 Dataset B (S07-hw-dataset-02.csv)

- **Лучший метод**: DBSCAN
- **Параметры**: eps=0.75, min_samples=14
- **Метрики**:
  - Silhouette: 0.552
  - Davies-Bouldin: 0.457
  - Calinski-Harabasz: 124.35
  - Доля шума: 0.0%
- **KMeans лучший**: k=2
  - Silhouette: 0.307
  - Davies-Bouldin: 1.323
- **Обоснование**: DBSCAN превосходит KMeans по всем метрикам (silhouette на 80% выше). Данные содержат шумовой признак и имеют нелинейную структуру, что идеально для DBSCAN.

### 4.3 Dataset C (S07-hw-dataset-03.csv)

- **Лучший метод**: KMeans
- **Параметры**: k=3
- **Метрики**:
  - Silhouette: 0.315
  - Davies-Bouldin: 1.160
  - Calinski-Harabasz: 9427.50
- **DBSCAN лучший**: eps=0.84, min_samples=8
  - Silhouette: 0.312
  - Davies-Bouldin: 1.221
  - Доля шума: 1.2%
- **Обоснование**: KMeans показывает немного лучшие метрики, особенно по Davies-Bouldin. Данные имеют смешанную структуру с компактными кластерами, где KMeans работает хорошо.

## 5. Analysis

### 5.1 Сравнение алгоритмов (важные наблюдения)

1. **Где KMeans "ломается"**:
   - На данных с нелинейной структурой (Dataset 2)
   - При наличии шумовых признаков (`z_noise` в Dataset 2)
   - Когда кластеры имеют разную плотность
   - Причина: KMeans предполагает сферические кластеры одинакового размера и плотности

2. **Где DBSCAN выигрывает**:
   - При наличии шума и выбросов
   - Для данных с нелинейными границами кластеров
   - Когда плотность кластеров неравномерна
   - Причина: DBSCAN не делает предположений о форме кластеров и устойчив к шуму

3. **Что сильнее всего влияло на результат**:
   - **Масштабирование**: Критически важно для всех методов
   - **Структура данных**: Сферическая vs нелинейная
   - **Наличие шума**: DBSCAN показал устойчивость, KMeans - уязвимость
   - **Плотность**: Равномерная плотность благоприятствует KMeans

### 5.2 Устойчивость (обязательно для одного датасета)

- **Проверка**: Оценка устойчивости KMeans на Dataset 1 при k=5
- **Метод**: 10 запусков с разными random_state [1, 2, ..., 10]
- **Результаты**:
  - Silhouette: среднее 0.355 ± 0.000 (разброс 0.000)
  - Inertia: среднее 25476 ± 0.0 (разброс 0.0)
  - Adjusted Rand Index: среднее 1.000 ± 0.000
- **Вывод**: KMeans показал абсолютную устойчивость на данном датасете. Все запуски дали идентичные результаты, что свидетельствует о чёткой структуре данных и удачной инициализации центроидов.

### 5.3 Интерпретация кластеров

- **Метод интерпретации**: Анализ центроидов кластеров и распределения признаков
- **Dataset 1 (k=2)**: 
  - Два чётких кластера с разными профилями признаков
  - Размеры: 46.5% и 53.5% от общего количества точек
  - Кластеры хорошо разделены в PCA пространстве
  
- **Dataset 2 (DBSCAN)**:
  - Два кластера с нелинейными границами
  - Нулевой шум, все точки отнесены к кластерам
  - Визуализация PCA подтверждает естественное разделение
  
- **Dataset 3 (k=3)**:
  - Три кластера с разной компактностью
  - Один кластер значительно меньше других
  - Кластеры частично перекрываются в 2D проекции

- **Вывод**: Для Dataset 1 и 3 кластеры имеют чёткую интерпретацию через центроиды. Для Dataset 2 DBSCAN выявил естественные группы, которые не были бы обнаружены KMeans из-за нелинейной структуры.

## 6. Conclusion

1. **Нет универсального метода**: KMeans идеален для сферических кластеров, DBSCAN - для данных с шумом и нелинейной структурой.

2. **Важность масштабирования**: Все методы требуют предварительного масштабирования данных для корректной работы.

3. **Метрики должны дополнять друг друга**: Silhouette, Davies-Bouldin и Calinski-Harabasz вместе дают полную картину качества кластеризации.

4. **Визуализация незаменима**: PCA 2D проекция часто показывает структуру данных лучше, чем числовые метрики.

5. **Параметры DBSCAN критичны**: Неправильный выбор eps и min_samples может привести к тривиальным результатам (все точки как шум или один кластер).

6. **Устойчивость важна**: KMeans может быть устойчивым на чётко структурированных данных, но чувствительным к инициализации на сложных данных.

7. **Контекст решает**: Выбор метода должен учитывать природу данных и бизнес-задачу, а не только числовые метрики.

8. **Экспериментирование необходимо**: Всегда тестируйте несколько методов с разными параметрами для нахождения оптимального решения.